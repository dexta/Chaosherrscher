<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chaos Game V1</title>
  <style type="text/css">
    body { background-color: #000; }
    .box { float: left; }
    .btn { margin: 2px; padding: 3px; border: 1px solid rgba(123,123,123,.5); }
  </style>
</head>
<body>
  <div class="box">
    <canvas id="canvas" width="800" height="600"></canvas>
  </div>
  <div class="box">
    <button class="btn" onclick="randomStart();colorStart();drawMassive(5000);">Random</button>
    <button class="btn" onclick="colorStart();drawMassive(5000);">Nice</button>
  </div>
  <script type="text/javascript">
    var canvas = document.getElementById('canvas');
    var ctx    = canvas.getContext('2d');
    var A=[0,0],B=[0,0],C=[0,0];
    var S=[0,0];
    
    var C={ color: '#F00', size: 2, width: 2, state: 0 };
    var P=[[400,300],[400,10],[10,590],[790,590]];
    // var P=[[400,300],[10,590],[790,590],[790,350],[150,320],[160,20],[223,42]];
    var F={
      A: function(a,b) {
        return [
          ( (a[0]+b[0])/2 ),
          ( (a[1]+b[1])/2 )
        ];
      },
      B: function(a,b) {
        return [
          ( (a[0]+b[0])/3 ),
          ( (a[1]+b[1])/3 )
        ];
      }
    };
    var picks={
      A: function(tp) {
        return tp[parseInt((Math.random()*(tp.length-1))+1)];
      },
      B: function(tp) {
        var be = parseInt((Math.random()*3)+(C.state*3));
        C.state=(C.state)? 0 : 1;
        return tp[be];
      }
    }

    function next() {
      var dp = F.A(P[0],picks.A(P));
      drawPoint(dp[0],dp[1]);
      P[0] = dp;
    }

    function rN(f) {
      return parseInt(Math.random()*f);
    }

    function rC() {
      return [rN(800),rN(600)];
    }

    function drawMassive(no) {
      let s = new Date()/1;
      for(var i=0;i<no;i++) { next();}
      console.log("time to Draw "+(new Date()/1-s));
    }

    function randomStart() {
      for(var n in P) {
        P[n] = rC();
      }
    }

    function colorStart() {
      drawPoint(P[0][0],P[0][1]);
      for(var i=1,il=P.length;i<il;i++) {
        drawPoint(P[i][0],P[i][1],'#0F0',5,5)
      }
    }

    function drawPoint(x,y,color,size,width) {
      ctx.beginPath();
      ctx.lineWidth = (width||false)? width : C.width;
      ctx.strokeStyle = (color||false)? color : C.color;
      var s = (size||false)? size : C.size;
      ctx.arc(x,y,s,0,2*Math.PI);
      ctx.stroke();
    }
  </script>  
</body>
</html>
